<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>New Product</title>
        
        
        <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
        <!------ Include the above in your HEAD tag ---------->
        
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
        <!-- Custom fonts for this template -->
        <!--
        <link href="vendor/datatables/dataTables.bootstrap4.css" rel="stylesheet">
        <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
        <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
         integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
   <link href="//netdna.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
        -->
        <!-- Plugin CSS -->
       
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
      <link rel="stylesheet" href="css/main.css">
    
     <script src="js/jquery.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="js/bootstrap.min.css">
  <script src="js/web3.min.js"></script>
  <script src="js/truffle-contract.js"></script>
  <script src="js/app.js"></script>
    </head>
    <body>
        <style type="text/css">
            .bs-example{
            margin-top: 0;
            margin: 20px;
            }
        </style>
        <div class="container">
            <!--
            <div class="row">
                    <div class="alert alert-danger alert-dismissible" role="alert">
                        <button type="button" onclick="this.parentNode.parentNode.removeChild(this.parentNode);" class="close" data-dismiss="alert"><span aria-hidden="true">Ã—</span><span class="sr-only">Close</span></button>
                        <strong><i class="fa fa-warning"></i> Warning!</strong> <marquee><p style="font-family: Impact; font-size: 18pt">YOU MUST HAVE AN ACCOUNT (MANUFACTURER) TO REGISTER A NEW PRODUCT !</p></marquee>
                    </div>
                </div>
                -->
        </div>
        <div class="bs-example">
            <nav class="navbar navbar-default">
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">
                    
                    <a href="http://127.0.0.1:3000/index.html" class="navbar-brand">EWASTE MANAGEMENT</a>
                </div>
                <!-- Collection of nav links and other content for toggling -->
                <div id="navbarCollapse" class="collapse navbar-collapse">
                    <ul class="nav navbar-nav">
                        <li class="active"><a href="#">Home</a></li>
                        <li id="notmanu"><a href="http://127.0.0.1:3000/pendingreq.html">Approve Transfers</a></li>
                        <li id="manubar"><a href="http://127.0.0.1:3000/newProduct.html">Register Product</a></li>
                        <div id="logged" class="nav navbar-nav navbar-right">
									<!--<li ><a href="http://127.0.0.1:3000/traceProduct.html">Trace Product</a></li>-->
								<li ><a href="http://127.0.0.1:3000/transferProduct.html">Transfer Product</a></li>
								<li ><a href="http://127.0.0.1:3000/index.html">Logout</a></li>
						</div>
                        
                    </ul>
                    <ul class="nav navbar-nav navbar-right">
                       
                        
                    </ul>
                   <!-- <ul class="nav navbar-nav navbar-right">
                        <li><a href="http://127.0.0.1:3000/login">Login</a></li>
                        <li><a href="http://127.0.0.1:3000/account">Sign Up</a></li>
                    </ul>-->
                </div>
            </nav>
        </div>
        <div class="container">    
                <script>
                  	$(document).ready(function(){
		//$('.manu').addClass("hidden");
        $("#manubar").hide();
                    $("#notmanu").hide();
                   
				console.log(sessionStorage.getItem("address"));
				if(sessionStorage.getItem("address")){
					$("#logged").show();
					$("#notlogged").hide();
				}
				else{
					$("#notlogged").show();
                }
		if(sessionStorage.getItem("usertype")=="Manufacturer"){
			
            $("#manubar").show();
            var $this = $('.manu');
			//if ($this.hasClass("hidden")) {
               // console.log("hi");
                //$(this).removeClass("hidden");
                $(this).addClass("visible");

        } 
        else
        {
            $(".manu").addClass("hidden");
            $("#notmanu").show();
        }    
       
	});
                   
                console.log(sessionStorage.getItem("usertype"));
               // console.log(usertype);
				

                    //console.log(usertype);
                   
                        </script>
            <h1 class="text-center">EWASTE MANAGEMENT</h1>
                 <br/>
            <div id="count"></div>
            <div id="det" style="padding-top: 10%;padding-left:50px;">
                <h3>Products currently owned:-</h3>
                <table style="width:100%">
                    <tr >
                    <th style="width:20%">
                            Name
                    </th>
                    <th style="width:20%">
                            Price
                    </th>
                    <th style="width:20%">
                            Type
                    </th>
                    <th style="width:20%">
                            Specs
                    </th>
                    <th style="width:20%">
                            Date of Manufacture
                    </th>
                    <script>
                    if(sessionStorage.getItem("usertype")=="Ewaste")
                    {
                        $("tran").hide();
                    }
                    else
                    $('tran').show();
                    </script>
                    <th id="tran" style="width:20%">
                            Link to transfer
                    </th>
                </tr>
                </table>
            </div>
            <br>
           
            <div class="manu" style="padding-top: 10%;padding-left:50px;">
                <h3 >Products Created:-</h3>
                    <table  id="manu" style="width:100%">
                        <tr >
                        <th style="width:20%">
                                Name
                        </th>
                        <th style="width:20%">
                                Price
                        </th>
                        <th style="width:20%">
                                Type
                        </th>
                        <th style="width:20%">
                                Specs
                        </th>
                        <th style="width:20%">
                                Date of Manufacture
                        </th>
                        <th style="width:20%">
                                Current Owner
                        </th>
                    </tr>
                    </table>
                </div>
            <script>
                var c;
              
               if(sessionStorage.getItem("usertype")=="Manufacturer"){
              
                ewaste._p_id((err, res) => {
    if (res)
    {
        //$("#count").html(res+" products"); 
        c=res.c;
        console.log(res.c);
        for(var i=0;i<res.c;i++){
            ewaste.getProduct_detailsByManu(i,getaccount, (err,res) =>{
            if (res)
            {
           // console.log(res);
            $("#manu").show();
            $("#manu").append("<tr ><td style=\"width:20%\">" + web3.toAscii(res[0]) + "</td><td style=\"width:20%\">" + res[1].c + "</td><td style=\"width:20%\">" + web3.toAscii(res[3]) + "</td><td style=\"width:20%\">"+web3.toAscii(res[2]) + "</td><td style=\"width:20%\">"+Date(res[5].c).toString().substr(4,11) + "</td><td style=\"width:20%\">"+web3.toAscii(res[4])+ "</td></tr>");
                
            }
            else
                console.log(err);
            
        });    
    }
}
       
});    
               }
                    
            ewaste._p_id((err, res) => {
    if (res)
    {
        if(sessionStorage.getItem("usertype")=="Ewaste")
        {
            $("#count").html(" total number of products recorded in the system: "+res); 
        c=res.c;
        //console.log(res.c);
        for(var i=0;i<res.c;i++){
           
           // console.log("pidab"+i);
            ewaste.getProduct_details(i,getaccount, (err,res) =>{
                
            if (res[1].c!=0)
            {
                var x=i;
           // console.log(res);
                var d=Date(res[4].c);
                //console.log(d.toString().substr(4,11));
               
            $("#det").append("<tr><td style=\"width:20%\">" + web3.toAscii(res[0]) + "</td><td style=\"width:20%\">" 
            + res[1].c + "</td><td style=\"width:20%\">" + web3.toAscii(res[3]) + "</td><td style=\"width: 20%\">"
            +web3.toAscii(res[2])  + "</td><td style=\"width:20%\">"+Date(res[4].c).toString().substr(4,11) 
            + "</td><td style=\"width:20%\">"+"not transferable"+"</td></tr>");
            console.log("hello");
            console.log("pidabc"+res[5]);
                sessionStorage.setItem("transfer_pid",res[5].c);
            }
            else
                console.log(err);
            
          });    
        }
    }
        else{
            $("#count").html(" total number of products recorded in the system: "+res); 
        c=res.c;
        console.log(res.c);
        for(var i=0;i<res.c;i++){
            var x=i;
           // console.log("pidab"+i);
            ewaste.getProduct_details(i,getaccount, (err,res) =>{
            if (res[1].c!=0)
            {
            console.log(res);
                var d=Date(res[4].c);
                //console.log(d.toString().substr(4,11));
               
            $("#det").append("<tr><td style=\"width:15%\">" + web3.toAscii(res[0]) + "</td><td style=\"width:15%\">" 
            + res[1].c + "</td><td style=\"width:16%\">" + web3.toAscii(res[3]) + "</td><td style=\"width: 24%\">"
            +web3.toAscii(res[2])  + "</td><td style=\"width:15%\">"+Date(res[4].c).toString().substr(4,11) 
            + "</td><td style=\"width:15%\"><a href=\"http://127.0.0.1:3000/transferProduct.html"
            +"\">Transfer</a></td></tr>");
           // console.log("pidabc"+x);
           console.log("hello");
            console.log("pidabc"+res[5]);
                sessionStorage.setItem("transfer_pid",res[5].c);
               // sessionStorage.setItem("transfer_pid",x);
            }
            else
                console.log(err);
            
        });    
        }
        
    }
}
       
});    
    console.log("pid "+sessionStorage.getItem("transfer_pid"));
            </script>
       
       
        <!--
             <h1 id="response"></h1>
        <ul id="data">
            <li id="productName"></li>
            <li id="productCost"></li>
            <li id="productSpecs"></li>
            <li id="productDesc"></li>
            <li id="productOwner"></li>
            <li id="ManufactureDate"></li>
        </ul>
      <script>
          
      $(document).ready(function(){
          $('#data').hide();
        $('#btnnew').click(function (event){
            event.preventDefault(); 
            $.ajax({
                type: 'POST',
                url:"http://127.0.0.1:3000/newProduct",
                headers: {
                    "content-type":"application/x-www-form-urlencoded"
                },  
                data: {
                    "uid":$('#u_id').val(),
                    "prdt_name":$('#product_name').val(),
                    "prdt_cost":$('#p_cost').val(),
                    "prdt_specs":$('#specs').val(),
                    "prdt_desc":$('#desp').val(),
                    
                },
                success: function (data){
                    console.log("data: ", data);
                    if(data != "Invalid User"){
                        $('#response').html('<p>Your product is registered and its ID id </p> <strong>'+data[0]+' </strong>');
                        $('#productName').html('<p>Your product name </p> <strong>'+data[1]+'</strong>');
                        $('#productCost').html('<p>Your product cost  </p> <strong>'+data[2]+'</strong>');
                        $('#productSpecs').html('<p>Your product specifications  </p> <strong>'+data[3]+'</strong>');
                        $('#productDesc').html('<p>Your product is description  </p> <strong>'+data[4]+'</strong>');
                        $('#productOwner').html('<p>Your Address </p> <strong>'+data[5]+'</strong>');
                        $('#ManufactureDate').html('<p>Product Registered on </p> <strong>'+data[6]+'</strong>');
                       $('#data').show();
                    }
                    alert(data);
                    //var number i=0;
                   
                   // window.location.href = "/trace";
                }
            })
            //console.log("Type: " , $('#myselect').val()+ " pass:  " + $('#password').val() + " User: "+ $('#name').val()  )
        });
    })
      
      
      </script>
     -->
     <script>
    
     </script>
</body>
</html>